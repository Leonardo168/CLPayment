Desenvolvida para integrar as funcionalidades das APIs do Mercado Pago e do Efí.
Para a compra de fichas, a CLPayment recebe uma requisição com o id do inventário ao qual as fichas serão adicionadas, as informações da ficha e a quantidade que será comprada, então cria uma transação no banco de dados e monta um objeto utilizado pelo MP chamado “Preferência”, com todos os dados necessários, e envia uma requisição para a API deles, que retorna um link para onde o usuário deverá ser encaminhado para finalizar a compra na plataforma Mercado Pago. Um webhook recebe notificações do Mercado Pago sempre que ocorre uma atualização no pagamento e atualiza a transação no banco de dados de acordo com o status notificado, quando a compra é concluída a API de pagamento envia uma requisição para a API principal adicionar as fichas ao inventário do usuário.
Para o resgate de fichas é feito um processo semelhante, a CLPayment recebe uma requisição similar a da compra, cria uma transação no banco de dados e monta um objeto que será encaminhado através de uma requisição para a API do Efí, mas os dados utilizados são diferentes, então a requisição recebida pela CLPayment deve incluir a chave PIX para onde o dinheiro será enviado, o objeto criado contém dados diferentes e um certificado P12 tem que ser incluído na requisição enviada ao Efí como medida de segurança. Também utiliza um webhook para receber notificações do Efí sempre que houver atualização no envio do PIX, atualizando a transação no banco de dados de acordo com o status notificado, quando o envio é concluído a API de pagamento envia uma requisição para a API principal remover as fichas do inventário do usuário.
